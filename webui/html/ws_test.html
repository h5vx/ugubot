<!DOCTYPE HTML>
<html>

<head>
    <script src="https://momentjs.com/downloads/moment.min.js"></script>
    <script src="https://momentjs.com/downloads/moment-timezone-with-data-10-year-range.min.js"></script>
    <script type="text/javascript">
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        let ws = null;

        function log(text, color = 'gray') {
            let el = document.createElement('p')
            el.innerHTML = text
            el.style.color = color
            document.body.appendChild(el)
        }

        document.addEventListener("DOMContentLoaded", function () {
            ws = new WebSocket("ws://localhost:8000/ws?token=" + getCookie('session'));

            ws.onopen = function () {
                log("Connection opened", "green")
                ws.send('{"message": "hello from client"}');
            };
            ws.onmessage = function (e) {
                log(e.data)
            };
            ws.onclose = function () {
                log("Connection closed", "red")
            };
        })

        function getChatList() {
            ws.send('{"command": "get_chat_list"}')
        }

        function getChatMessages() {
            const tz = moment.tz.guess()
            const date = document.getElementById("date-input").value.replaceAll("-", "/")
            ws.send(JSON.stringify({
                command: "get_messages",
                chat_id: 1,
                date: date,
                client_timezone: tz
            }))
        }

        function getDates() {
            const tz = moment.tz.guess()
            ws.send(JSON.stringify({
                command: "get_dates",
                client_timezone: tz
            }))
        }
    </script>
</head>

<body>
    <div>
        <button onclick="getChatList()">Get chat list</button>
        <button onclick="getChatMessages()">Get messages on</button>
        <button onclick="getDates()">Get dates</button>
        <input type="date" id="date-input">
    </div>
</body>

</html>